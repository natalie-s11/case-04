<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Survey Form</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<main>
    <h1>Survey</h1>
    <form id="survey-form">
        <label>
            Name: <input type="text" name="name" required>
        </label>
        <label>
            Email: <input type="email" name="email" required>
        </label>
        <label>
            Age: <input type="number" name="age" required>
        </label>
        <label>
            Consent: <input type="checkbox" name="consent">
        </label>
        <label>
            Rating (1-5): <input type="number" name="rating" min="1" max="5" required>
        </label>
        <label>
            Comments: <textarea name="comments"></textarea>
        </label>
        <label>
            Source:
            <select name="source">
                <option value="website">Website</option>
                <option value="friend">Friend</option>
                <option value="other">Other</option>
            </select>
        </label>
        <button type="submit" id="submitBtn">Submit</button>
    </form>

    <section id="result" class="result" aria-live="polite"></section>
</main>

<script>
const form = document.getElementById("survey-form");
const result = document.getElementById("result");
const submitBtn = document.getElementById("submitBtn");

form.addEventListener("submit", async (e) => {
    e.preventDefault();
    result.textContent = "";
    submitBtn.disabled = true;

    // Build payload
    const fd = new FormData(form);
    const payload = {
        name: (fd.get("name") || "").toString(),
        email: (fd.get("email") || "").toString(),
        age: Number(fd.get("age")),
        consent: fd.get("consent") === "on",
        rating: Number(fd.get("rating")),
        comments: (fd.get("comments") || "").toString(),
        source: (fd.get("source") || "other").toString()
    };

    try {
        const res = await fetch(
            "https://ood.hpc.virginia.edu/rnode/udc-aw32-11c0/9494/proxy/5000/v1/survey",
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            }
        );

        if (res.ok) {
            result.textContent = "Survey submitted successfully!";
        } else {
            result.textContent = "Submission failed. Please try again.";
        }
    } catch (err) {
        console.error(err);
        result.textContent = "Error submitting survey. Check console.";
    } finally {
        submitBtn.disabled = false;
    }
});
</script>
</body>
</html>

